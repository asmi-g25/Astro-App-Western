<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Searchster Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        input, button { margin: 5px; padding: 5px; }
    </style>
</head>
<body>
    <h1>Searchster Test Page</h1>
    
    <div class="test-section">
        <h3>Test 1: Library Loading</h3>
        <div id="library-test"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Location Autocomplete</h3>
        <input type="text" id="location-test" placeholder="Type a city name...">
        <div id="location-results"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Astrology Calculation</h3>
        <input type="date" id="test-date" value="1990-01-01">
        <input type="time" id="test-time" value="12:00">
        <input type="text" id="test-location" value="New York">
        <button onclick="testAstrology()">Test Astrology</button>
        <div id="astrology-results"></div>
    </div>

    <!-- Reference Libraries -->
    <script src="libs/sweph-reference.js"></script>
    <script src="libs/geocoder-reference.js"></script>
    
    <!-- Application Engine -->
    <script src="engine/core.js"></script>
    <script src="engine/astrology.js"></script>
    <script src="engine/network.js"></script>
    <script src="engine/ui.js"></script>
    
    <script>
                 // Test 1: Library Loading
         function testLibraries() {
             const results = document.getElementById('library-test');
             let html = '';
             
             console.log('Testing library loading...');
             console.log('SwissEphemeris:', typeof SwissEphemeris);
             console.log('BrowserGeocoder:', typeof BrowserGeocoder);
             console.log('window.AstrologyEngine:', typeof window.AstrologyEngine);
             console.log('window.astrology:', typeof window.astrology);
             console.log('window.SearchsterApp:', typeof window.SearchsterApp);
             console.log('window.NetworkEngine:', typeof window.NetworkEngine);
             
             // Check if classes exist in global scope
             console.log('Checking global scope...');
             console.log('AstrologyEngine in global scope:', typeof AstrologyEngine);
             console.log('SearchsterApp in global scope:', typeof SearchsterApp);
             console.log('NetworkEngine in global scope:', typeof NetworkEngine);
             
             if (typeof SwissEphemeris !== 'undefined') {
                 html += '<div class="success">✓ SwissEphemeris loaded</div>';
             } else {
                 html += '<div class="error">✗ SwissEphemeris not loaded</div>';
             }
             
             if (typeof BrowserGeocoder !== 'undefined') {
                 html += '<div class="success">✓ BrowserGeocoder loaded</div>';
             } else {
                 html += '<div class="error">✗ BrowserGeocoder not loaded</div>';
             }
             
             if (typeof window.AstrologyEngine !== 'undefined') {
                 html += '<div class="success">✓ AstrologyEngine class available</div>';
             } else {
                 html += '<div class="error">✗ AstrologyEngine class not available</div>';
             }
             
             if (typeof window.astrology !== 'undefined') {
                 html += '<div class="success">✓ Astrology engine instance available</div>';
             } else {
                 html += '<div class="error">✗ Astrology engine instance not available</div>';
             }
             
             if (typeof window.SearchsterApp !== 'undefined') {
                 html += '<div class="success">✓ SearchsterApp class available</div>';
             } else {
                 html += '<div class="error">✗ SearchsterApp class not available</div>';
             }
             
             if (typeof window.NetworkEngine !== 'undefined') {
                 html += '<div class="success">✓ NetworkEngine class available</div>';
             } else {
                 html += '<div class="error">✗ NetworkEngine class not available</div>';
             }
             
             results.innerHTML = html;
         }
        
                 // Test 2: Location Autocomplete
         function testLocationAutocomplete() {
             const input = document.getElementById('location-test');
             const results = document.getElementById('location-results');
             
             input.addEventListener('input', async (e) => {
                 const query = e.target.value.trim();
                 if (query.length < 2) {
                     results.innerHTML = '';
                     return;
                 }
                 
                 // Show fallback suggestions immediately
                 const fallbackSuggestions = getFallbackSuggestions(query);
                 if (fallbackSuggestions.length > 0) {
                     results.innerHTML = '<div style="color: blue;">Fallback suggestions:</div>' + 
                         fallbackSuggestions.map(item => 
                             `<div style="color: blue;">${item.display_name}</div>`
                         ).join('');
                 }
                 
                 try {
                     const response = await fetch(
                         `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=3`
                     );
                     
                     if (response.ok) {
                         const data = await response.json();
                         results.innerHTML = '<div style="color: green;">API suggestions:</div>' + 
                             data.map(item => 
                                 `<div style="color: green;">${item.display_name}</div>`
                             ).join('');
                     } else {
                         results.innerHTML = '<div class="error">API Error: ' + response.status + '</div>';
                     }
                 } catch (error) {
                     results.innerHTML = '<div class="error">Network Error: ' + error.message + '</div>';
                 }
             });
         }
         
         // Fallback suggestions function (same as in ui.js)
         function getFallbackSuggestions(query) {
             const commonCities = [
                 { display_name: 'New York, NY, USA', lat: '40.7128', lon: '-74.0060' },
                 { display_name: 'Los Angeles, CA, USA', lat: '34.0522', lon: '-118.2437' },
                 { display_name: 'Chicago, IL, USA', lat: '41.8781', lon: '-87.6298' },
                 { display_name: 'Houston, TX, USA', lat: '29.7604', lon: '-95.3698' },
                 { display_name: 'Phoenix, AZ, USA', lat: '33.4484', lon: '-112.0740' },
                 { display_name: 'Philadelphia, PA, USA', lat: '39.9526', lon: '-75.1652' },
                 { display_name: 'San Antonio, TX, USA', lat: '29.4241', lon: '-98.4936' },
                 { display_name: 'San Diego, CA, USA', lat: '32.7157', lon: '-117.1611' },
                 { display_name: 'Dallas, TX, USA', lat: '32.7767', lon: '-96.7970' },
                 { display_name: 'San Jose, CA, USA', lat: '37.3382', lon: '-121.8863' },
                 { display_name: 'London, UK', lat: '51.5074', lon: '-0.1278' },
                 { display_name: 'Paris, France', lat: '48.8566', lon: '2.3522' },
                 { display_name: 'Berlin, Germany', lat: '52.5200', lon: '13.4050' },
                 { display_name: 'Madrid, Spain', lat: '40.4168', lon: '-3.7038' },
                 { display_name: 'Rome, Italy', lat: '41.9028', lon: '12.4964' },
                 { display_name: 'Tokyo, Japan', lat: '35.6762', lon: '139.6503' },
                 { display_name: 'Beijing, China', lat: '39.9042', lon: '116.4074' },
                 { display_name: 'Mumbai, India', lat: '19.0760', lon: '72.8777' },
                 { display_name: 'Sydney, Australia', lat: '-33.8688', lon: '151.2093' },
                 { display_name: 'Toronto, Canada', lat: '43.6532', lon: '-79.3832' }
             ];
             
             const queryLower = query.toLowerCase();
             return commonCities.filter(city => 
                 city.display_name.toLowerCase().includes(queryLower)
             ).slice(0, 5);
         }
        
                 // Test 3: Astrology Calculation
         async function testAstrology() {
             const results = document.getElementById('astrology-results');
             const date = document.getElementById('test-date').value;
             const time = document.getElementById('test-time').value;
             const location = document.getElementById('test-location').value;
             
             try {
                 results.innerHTML = 'Calculating...';
                 
                 // Use the global astrology instance
                 if (typeof window.astrology === 'undefined') {
                     throw new Error('Astrology engine not available');
                 }
                 
                 // Initialize if not already done
                 if (!window.astrology.initialized) {
                     window.astrology.initialize();
                 }
                 
                 const natalChart = await window.astrology.calculateNatalChart(date, time, location);
                 
                 results.innerHTML = `
                     <div class="success">
                         <h4>Natal Chart Calculated Successfully</h4>
                         <p>Sun Position: ${natalChart.sunPosition.toFixed(2)}°</p>
                         <p>Moon Position: ${natalChart.moonPosition.toFixed(2)}°</p>
                         <p>Location: ${location}</p>
                         <p>Coordinates: ${natalChart.lat || 'N/A'}, ${natalChart.lon || 'N/A'}</p>
                     </div>
                 `;
             } catch (error) {
                 results.innerHTML = `
                     <div class="error">
                         <h4>Error in Astrology Calculation</h4>
                         <p>${error.message}</p>
                         <pre>${error.stack}</pre>
                     </div>
                 `;
             }
         }
        
                 // Initialize tests
         document.addEventListener('DOMContentLoaded', function() {
             console.log('DOM loaded, waiting for scripts...');
             // Add a small delay to ensure all scripts are loaded
             setTimeout(() => {
                 console.log('Running tests...');
                 testLibraries();
                 testLocationAutocomplete();
                 
                 // Try to manually expose classes if they're not available
                 if (typeof window.AstrologyEngine === 'undefined' && typeof AstrologyEngine !== 'undefined') {
                     console.log('Manually exposing AstrologyEngine...');
                     window.AstrologyEngine = AstrologyEngine;
                 }
                 if (typeof window.SearchsterApp === 'undefined' && typeof SearchsterApp !== 'undefined') {
                     console.log('Manually exposing SearchsterApp...');
                     window.SearchsterApp = SearchsterApp;
                 }
                 if (typeof window.NetworkEngine === 'undefined' && typeof NetworkEngine !== 'undefined') {
                     console.log('Manually exposing NetworkEngine...');
                     window.NetworkEngine = NetworkEngine;
                 }
             }, 100);
         });
    </script>
</body>
</html> 